<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iris-polymer-importer/iris-importer.html">

<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<link rel="import" href="test/test-data.html">


<dom-module id="iris-ticketlist">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: inline-block;
      }
      
      #dialog {
        width: 100%;
        top: 64px;
        bottom: 0px;
        margin: 0;
        border-top: 3px solid #E44E34;
      }
      
      .dialog-head {
        text-align: left;
        font-size: 19px;
        padding-left: 15px;
        position: relative;
        margin-top: 10px;
      }
      
      paper-fab {
        border-radius: 3px;
        background-color: rgba(0, 0, 0, 0.0);
        border: 3px solid #6E4D44;
        color: #6E4D44;
      }
      
      paper-fab.flat {
        @applay(--shadow-none);
      }
      
      .flexchild {
        width: 15%;
      }
      
      .service-name {
        width: 35%;
      }
      
      paper-listbox span {
        text-align: center;
      }
      
      paper-item {
        border-bottom: 1px solid;
        border-color: var(--paper-grey-300);
      }
    </style>

    <paper-dialog id="dialog" entry-animation="slide-from-left-animation" exit-animation="slide-left-animation">
      <div class='dialog-head'>
        <paper-fab class="flat" mini icon="chevron-left" elevation="0" on-click="close"> </paper-fab>
      </div>
      <paper-dialog-scrollable>
        <paper-listbox id="list">
          <paper-item>
            <template is="dom-if" if="{{hasActions}}">
              <span class="flexchild">Действие</span>
            </template>

            <span class="flexchild">№ талона</span>
            <span class="service-name">Услуга</span>
            <span class="flexchild">Число дел</span>
            <span class="flexchild">ФИО</span>
            <spanclass="flexchild">Время ожидания</span>
          </paper-item>
          <template is="dom-repeat" items="{{tickets}}" as="item">
            <paper-item class="container" on-tap="expandItem ">
              <template is="dom-if" if="{{hasActions}}">
                <span class="flexchild">
                  <paper-button on-tap="ticketAction">Принять</paper-button>
                </span>
              </template>

              <span class="flexchild">[[item.number]]</span>
              <span class="service-name">[[item.service]]</span>
              <span class="flexchild">[[item.service_count]]</span>
              <span class="flexchild">{{computeName(item.fields)}}</span>
              <span class="flexchild">
                <iris-doomclock start="{{item.time_bounds.start}}"></iris-doomclock>
              </span>
            </paper-item>
          </template>
        </paper-listbox>
      </paper-dialog-scrollable>

    </paper-dialog>


  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'iris-ticketlist',
        properties: {
          tickets: {
            type: Array,
            value: function() {
              return [];
            }
          },
          hasActions: {
            type: Boolean,
            value: function() {
              return false;
            }
          }
        },
        ready() {
          this.$.dialog.sizingTarget = app;
        },
        expandItem() {
          //@TODO: load history, etc.
          let selected = this.$.list.selected;

        },
        ticketAction() {
          let selected = this.$.list.selected;
        },
        computeName(fields) {
          let name = fields.name[0] + '.';
          let lastname = fields.lastname;
          let patronymic = fields.patronymic ? fields.patronymic[0] + '.' : '';
          return `${lastname} ${name} ${patronymic}`;
        },
        close() {
          this.$.dialog.close();
        },
        open() {
          this.$.dialog.open();
        }
      });
    })();
  </script>

</dom-module>